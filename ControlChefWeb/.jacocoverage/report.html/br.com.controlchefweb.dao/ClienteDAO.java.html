<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ClienteDAO.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;ControlChefWeb&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">br.com.controlchefweb.dao</a> &gt; <span class="el_source">ClienteDAO.java</span></div><h1>ClienteDAO.java</h1><pre class="source lang-java linenums">/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package br.com.controlchefweb.dao;

import br.com.controlchefweb.entidade.Cliente;
import br.com.controlchefweb.util.FabricaConexao;
import br.com.controlchefweb.util.exception.ErroSistema;
import java.io.Serializable;
import java.sql.Connection;
import java.sql.Date;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

/**
 *
 * @author VashJHK
 */
<span class="fc" id="L24">public class ClienteDAO implements CrudDAO&lt;Cliente&gt;, Serializable {</span>
    
    private static final long serialVersionUID = 1L;
    
    public List&lt;Cliente&gt; buscarNome(String nome) throws ErroSistema {
        try {
<span class="fc" id="L30">            Connection conexao = FabricaConexao.getConexao();</span>
<span class="fc" id="L31">            PreparedStatement ps = conexao.prepareStatement(&quot;select * from cliente where nome like '%&quot;+nome+&quot;%'&quot;);</span>
<span class="fc" id="L32">            ResultSet resultSet = ps.executeQuery();</span>
<span class="fc" id="L33">            List&lt;Cliente&gt; clientes = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L34" title="All 2 branches covered.">            while (resultSet.next()) {</span>
<span class="fc" id="L35">                Cliente cliente = new Cliente();</span>
<span class="fc" id="L36">                cliente.setCpf(resultSet.getString(&quot;cpf&quot;));</span>
<span class="fc" id="L37">                cliente.setNome(resultSet.getString(&quot;nome&quot;));</span>
<span class="fc" id="L38">                cliente.setDataNasc(resultSet.getDate(&quot;dataNasc&quot;));</span>
<span class="fc" id="L39">                cliente.setDataCad(resultSet.getDate(&quot;dataCad&quot;));</span>
<span class="fc" id="L40">                clientes.add(cliente);</span>
<span class="fc" id="L41">            }</span>
<span class="fc" id="L42">            FabricaConexao.fecharConexao();</span>
<span class="fc" id="L43">            return clientes;</span>

<span class="nc" id="L45">        } catch (SQLException ex) {</span>
<span class="nc" id="L46">            throw new ErroSistema(&quot;Erro ao buscar o produto filtrado!&quot;, ex);</span>
        }
    }
    
    public Cliente buscarCPF(String cpf) throws ErroSistema{
        try {
<span class="fc" id="L52">            Connection conexao = FabricaConexao.getConexao();</span>
<span class="fc" id="L53">            PreparedStatement ps = conexao.prepareStatement(&quot;select * from cliente where cpf=?&quot;);</span>
<span class="fc" id="L54">            ps.setString(1, cpf);</span>
<span class="fc" id="L55">            ResultSet resultSet = ps.executeQuery();</span>
<span class="fc" id="L56">            Cliente cliente = new Cliente();</span>
<span class="fc bfc" id="L57" title="All 2 branches covered.">            if (resultSet.next()) {  </span>
<span class="fc" id="L58">                cliente.setCpf(resultSet.getString(&quot;cpf&quot;));</span>
<span class="fc" id="L59">                cliente.setNome(resultSet.getString(&quot;nome&quot;));</span>
<span class="fc" id="L60">                cliente.setDataNasc(resultSet.getDate(&quot;dataNasc&quot;));</span>
<span class="fc" id="L61">                cliente.setDataCad(resultSet.getDate(&quot;dataCad&quot;));</span>
<span class="fc" id="L62">                return cliente;</span>
            }
<span class="fc" id="L64">            FabricaConexao.fecharConexao();</span>
<span class="fc" id="L65">            return null;</span>

<span class="nc" id="L67">        } catch (SQLException ex) {</span>
<span class="nc" id="L68">            throw new ErroSistema(&quot;Erro ao buscar o cliente pelo CPF!&quot;, ex);</span>
        }
    }

     @Override
    public void salvar(Cliente entidade) throws ErroSistema {
        try {
<span class="fc" id="L75">            Connection conexao = FabricaConexao.getConexao();</span>
            PreparedStatement ps;
            java.sql.Date dataBanco;
<span class="fc" id="L78">            java.util.Date hoje = new java.util.Date();</span>
            
<span class="fc" id="L80">            ps = conexao.prepareStatement(&quot;INSERT INTO cliente (nome,dataNasc,dataCad,cpf) VALUES (?,?,?,?)&quot;);</span>
            
<span class="fc" id="L82">            ps.setString(1, entidade.getNome());</span>
<span class="fc" id="L83">            dataBanco = new java.sql.Date(entidade.getDataNasc().getTime());</span>
<span class="fc" id="L84">            ps.setDate(2,dataBanco);</span>
<span class="fc" id="L85">            dataBanco = new java.sql.Date(hoje.getTime());</span>
<span class="fc" id="L86">            ps.setDate(3,dataBanco);</span>
<span class="fc" id="L87">            ps.setString(4, entidade.getCpf());</span>
<span class="fc" id="L88">            ps.execute();</span>
<span class="fc" id="L89">            FabricaConexao.fecharConexao();</span>
<span class="nc" id="L90">        } catch (SQLException ex) {</span>
<span class="nc" id="L91">            throw new ErroSistema(&quot;Erro ao tentar salvar Cliente!&quot;, ex);</span>
<span class="fc" id="L92">        }</span>
<span class="fc" id="L93">    }</span>
    
    public void update(Cliente entidade) throws ErroSistema {
        try {
<span class="fc" id="L97">            Connection conexao = FabricaConexao.getConexao();</span>
            PreparedStatement ps;
            java.sql.Date dataBanco;
            
     
<span class="fc" id="L102">            ps = conexao.prepareStatement(&quot;update cliente set nome=?, dataNasc=?, dataCad=? where cpf=?&quot;);</span>
      
    
<span class="fc" id="L105">            ps.setString(1, entidade.getNome());</span>
<span class="fc" id="L106">            dataBanco = new java.sql.Date(entidade.getDataNasc().getTime());</span>
<span class="fc" id="L107">            ps.setDate(2,dataBanco);</span>
<span class="fc" id="L108">            dataBanco = new java.sql.Date(entidade.getDataCad().getTime());</span>
<span class="fc" id="L109">            ps.setDate(3,dataBanco);</span>
<span class="fc" id="L110">            ps.setString(4, entidade.getCpf());</span>
<span class="fc" id="L111">            ps.execute();</span>
<span class="fc" id="L112">            FabricaConexao.fecharConexao();</span>
<span class="nc" id="L113">        } catch (SQLException ex) {</span>
<span class="nc" id="L114">            throw new ErroSistema(&quot;Erro ao tentar atualizar Cliente!&quot;, ex);</span>
<span class="fc" id="L115">        }</span>
<span class="fc" id="L116">    }</span>

    @Override
    public void deletar(Cliente entidade) throws ErroSistema {
        try {
<span class="fc" id="L121">            Connection conexao = FabricaConexao.getConexao();</span>
<span class="fc" id="L122">            PreparedStatement ps0 = conexao.prepareStatement(&quot;update pagamento set id_cliente=? where id_cliente=?&quot;);</span>
<span class="fc" id="L123">            ps0.setString(1,null);</span>
<span class="fc" id="L124">            ps0.setString(2,entidade.getCpf());</span>
<span class="fc" id="L125">            ps0.execute();</span>
            
<span class="fc" id="L127">            PreparedStatement ps = conexao.prepareStatement(&quot;delete from cliente where cpf = ?&quot;);</span>
<span class="fc" id="L128">            ps.setString(1, entidade.getCpf());</span>
<span class="fc" id="L129">            ps.execute();</span>
<span class="nc" id="L130">        } catch (SQLException ex) {</span>
<span class="nc" id="L131">            throw new ErroSistema(&quot;Erro ao deletar Cliente!&quot;, ex);</span>
<span class="fc" id="L132">        }</span>
<span class="fc" id="L133">    }</span>

    @Override
    public List&lt;Cliente&gt; buscar() throws ErroSistema {
        try {
<span class="fc" id="L138">            Connection conexao = FabricaConexao.getConexao();</span>
<span class="fc" id="L139">            PreparedStatement ps = conexao.prepareStatement(&quot;select * from cliente&quot;);</span>
<span class="fc" id="L140">            ResultSet resultSet = ps.executeQuery();</span>
<span class="fc" id="L141">            List&lt;Cliente&gt; usuarios = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L142" title="All 2 branches covered.">            while (resultSet.next()) {</span>
<span class="fc" id="L143">                Cliente usuario = new Cliente();</span>
<span class="fc" id="L144">                usuario.setCpf(resultSet.getString(&quot;cpf&quot;));</span>
<span class="fc" id="L145">                usuario.setNome(resultSet.getString(&quot;nome&quot;));</span>
<span class="fc" id="L146">                usuario.setDataNasc(resultSet.getDate(&quot;dataNasc&quot;));</span>
<span class="fc" id="L147">                usuario.setDataCad(resultSet.getDate(&quot;dataCad&quot;));</span>
<span class="fc" id="L148">                usuarios.add(usuario);</span>
<span class="fc" id="L149">            }</span>
<span class="fc" id="L150">            FabricaConexao.fecharConexao();</span>
<span class="fc" id="L151">            return usuarios;</span>

<span class="nc" id="L153">        } catch (SQLException ex) {</span>
<span class="nc" id="L154">            throw new ErroSistema(&quot;Erro ao buscar os clientes!&quot;, ex);</span>
        }
    }
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>