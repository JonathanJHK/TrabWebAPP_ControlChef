<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>PedidoDAO.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;ControlChefWeb&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">br.com.controlchefweb.dao</a> &gt; <span class="el_source">PedidoDAO.java</span></div><h1>PedidoDAO.java</h1><pre class="source lang-java linenums">/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package br.com.controlchefweb.dao;

import br.com.controlchefweb.entidade.Funcionario;
import br.com.controlchefweb.entidade.ItemPedido;
import br.com.controlchefweb.entidade.Pedido;
import br.com.controlchefweb.entidade.Produto;
import br.com.controlchefweb.util.FabricaConexao;
import br.com.controlchefweb.util.exception.ErroSistema;
import java.io.Serializable;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import javax.faces.bean.ManagedBean;
import javax.faces.bean.SessionScoped;

/**
 *
 * @author VashJHK
 */
@ManagedBean(name = &quot;PedidoDAO&quot;)
@SessionScoped
<span class="fc" id="L31">public class PedidoDAO implements CrudDAO&lt;Pedido&gt;, Serializable {</span>


    public void criar(int mesa) throws ErroSistema {
        try {
<span class="fc" id="L36">            Connection conexao = FabricaConexao.getConexao();</span>
            PreparedStatement ps;
<span class="fc" id="L38">            Date hoje = new Date();</span>

<span class="fc" id="L40">            ps = conexao.prepareStatement(&quot;INSERT INTO `pedido` (`mesa`,`statusPedido`,`dataCriacao`) VALUES (?,?,?)&quot;);</span>

<span class="fc" id="L42">            ps.setInt(1, mesa);</span>
<span class="fc" id="L43">            ps.setBoolean(2, true);</span>
<span class="fc" id="L44">            ps.setDate(3,new java.sql.Date(hoje.getTime()));</span>

<span class="fc" id="L46">            ps.execute();</span>
<span class="fc" id="L47">            FabricaConexao.fecharConexao();</span>
<span class="nc" id="L48">        } catch (SQLException ex) {</span>
<span class="nc" id="L49">            throw new ErroSistema(&quot;Erro ao tentar criar pedido!&quot;, ex);</span>
<span class="fc" id="L50">        }</span>
<span class="fc" id="L51">    }</span>

    public Pedido buscarPedido(int mesa) throws ErroSistema {
        try {
<span class="fc" id="L55">            Connection conexao = FabricaConexao.getConexao();</span>
<span class="fc" id="L56">            PreparedStatement ps = conexao.prepareStatement(&quot;select * from pedido where pedido.mesa=? and pedido.statusPedido=true&quot;);</span>
<span class="fc" id="L57">            ps.setInt(1, mesa);</span>
<span class="fc" id="L58">            ResultSet resultSet = ps.executeQuery();</span>
<span class="fc" id="L59">            Pedido pedido = new Pedido();</span>
            Funcionario funcionario;
<span class="fc" id="L61">            FuncionarioDAO funDao = new FuncionarioDAO();</span>

<span class="pc bpc" id="L63" title="1 of 2 branches missed.">            if (resultSet.next()) {</span>
<span class="fc" id="L64">                pedido.setId(resultSet.getInt(&quot;id&quot;));</span>
<span class="fc" id="L65">                funcionario = funDao.buscarID(resultSet.getInt(&quot;vendedor&quot;));</span>
<span class="fc" id="L66">                pedido.setVendedor(funcionario);</span>
<span class="fc" id="L67">                pedido.setValorTotal(resultSet.getDouble(&quot;valorTotal&quot;));</span>
<span class="fc" id="L68">                pedido.setMesa(resultSet.getInt(&quot;mesa&quot;));</span>
<span class="fc" id="L69">                pedido.setStatusPedido(resultSet.getBoolean(&quot;statusPedido&quot;));</span>
<span class="fc" id="L70">                pedido.setDataCriacao(resultSet.getDate(&quot;dataCriacao&quot;));</span>
<span class="fc" id="L71">                pedido.setItens(buscarProdutoPedido(resultSet.getInt(&quot;id&quot;)));</span>
            } else {
<span class="nc" id="L73">                return null;</span>
            }
<span class="fc" id="L75">            FabricaConexao.fecharConexao();</span>
<span class="fc" id="L76">            return pedido;</span>
<span class="nc" id="L77">        } catch (SQLException ex) {</span>
<span class="nc" id="L78">            throw new ErroSistema(&quot;Erro ao tentar criar pedido!&quot;, ex);</span>
        }
    }

    public List&lt;ItemPedido&gt; buscarProdutoPedido(int idpedido) throws ErroSistema {
        try {
<span class="fc" id="L84">            Connection conexao = FabricaConexao.getConexao();</span>
<span class="fc" id="L85">            PreparedStatement ps = conexao.prepareStatement(&quot;SELECT produto.id, produto.nome,produto.preco,produto.descricao,produto.imagem,produto.disponivel,produto.tipo,itempedido.quantidade,itempedido.valor_item,itempedido.status_pedido,itempedido.entrega,itempedido.id as id_pedido FROM produto,itempedido where itempedido.id_produto = produto.id and itempedido.id in (select pedido_item.id_item FROM pedido_item where pedido_item.id_pedido = ?)&quot;);</span>
<span class="fc" id="L86">            ps.setInt(1, idpedido);</span>
<span class="fc" id="L87">            ResultSet resultSet = ps.executeQuery();</span>

<span class="fc" id="L89">            List&lt;ItemPedido&gt; itens = new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L90" title="1 of 2 branches missed.">            while (resultSet.next()) {</span>
<span class="nc" id="L91">                ItemPedido itempedido = new ItemPedido();</span>
<span class="nc" id="L92">                Produto produto = new Produto();</span>
<span class="nc" id="L93">                produto.setId(resultSet.getInt(&quot;id&quot;));</span>
<span class="nc" id="L94">                produto.setNome(resultSet.getString(&quot;nome&quot;));</span>
<span class="nc" id="L95">                produto.setDescricao(resultSet.getString(&quot;descricao&quot;));</span>
<span class="nc" id="L96">                produto.setPreco(resultSet.getDouble(&quot;preco&quot;));</span>
<span class="nc" id="L97">                produto.setImagem(resultSet.getString(&quot;imagem&quot;));</span>
<span class="nc" id="L98">                produto.setDisponivel(resultSet.getBoolean(&quot;disponivel&quot;));</span>
<span class="nc" id="L99">                produto.setTipo(resultSet.getString(&quot;tipo&quot;));</span>

<span class="nc" id="L101">                itempedido.setId(resultSet.getInt(&quot;id_pedido&quot;));</span>
<span class="nc" id="L102">                itempedido.setProduto(produto);</span>
<span class="nc" id="L103">                itempedido.setQuantidade(resultSet.getInt(&quot;quantidade&quot;));</span>
<span class="nc" id="L104">                itempedido.setValorItem(resultSet.getDouble(&quot;valor_item&quot;));</span>
<span class="nc" id="L105">                itempedido.setStatusItem(resultSet.getBoolean(&quot;status_pedido&quot;));</span>
<span class="nc" id="L106">                itempedido.setEntrega(resultSet.getBoolean(&quot;entrega&quot;));</span>
<span class="nc" id="L107">                itens.add(itempedido);</span>
<span class="nc" id="L108">            }</span>

<span class="fc" id="L110">            FabricaConexao.fecharConexao();</span>
<span class="fc" id="L111">            return itens;</span>
<span class="nc" id="L112">        } catch (SQLException ex) {</span>
<span class="nc" id="L113">            throw new ErroSistema(&quot;Erro ao buscar os item pedido!&quot;, ex);</span>
        }
    }

    @Override
    public void salvar(Pedido entidade) throws ErroSistema {
         try {
<span class="fc" id="L120">            Connection conexao = FabricaConexao.getConexao();</span>
            PreparedStatement ps;
            
<span class="fc" id="L123">            ps = conexao.prepareStatement(&quot;update pedido set vendedor=?,valorTotal=?, statusPedido=? where id=?&quot;);</span>
                
          
<span class="nc" id="L126">            ps.setInt(1, entidade.getVendedor().getId());</span>
<span class="nc" id="L127">            ps.setDouble(2, entidade.getValorTotal());</span>
<span class="nc" id="L128">            ps.setBoolean(3, entidade.isStatusPedido());</span>
<span class="nc" id="L129">            ps.setInt(4, entidade.getId());</span>
<span class="nc" id="L130">            ps.execute();</span>
<span class="nc" id="L131">            FabricaConexao.fecharConexao();</span>
<span class="nc" id="L132">        } catch (SQLException ex) {</span>
<span class="nc" id="L133">            throw new ErroSistema(&quot;Erro ao tentar salvar funcionario!&quot;, ex);</span>
<span class="nc" id="L134">        }</span>
<span class="nc" id="L135">    }</span>

    @Override
    public void deletar(Pedido entidade) throws ErroSistema {
        try {
<span class="fc" id="L140">            ItemPedidoDAO itemDao = new ItemPedidoDAO();</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">            for(ItemPedido s: entidade.getItens()){</span>
<span class="nc" id="L142">                itemDao.deletar(s);</span>
<span class="nc" id="L143">            }</span>
<span class="nc" id="L144">            Connection conexao = FabricaConexao.getConexao();</span>
<span class="nc" id="L145">            PreparedStatement ps = conexao.prepareStatement(&quot;delete from pedido where id = ?&quot;);</span>
<span class="nc" id="L146">            ps.setInt(1, entidade.getId());</span>
<span class="nc" id="L147">            ps.execute();</span>
<span class="nc" id="L148">        } catch (SQLException ex) {</span>
<span class="nc" id="L149">            throw new ErroSistema(&quot;Erro ao deletar pedido!&quot;, ex);</span>
<span class="nc" id="L150">        }</span>
<span class="nc" id="L151">    }</span>

    @Override
    public List&lt;Pedido&gt; buscar() throws ErroSistema {
        try {
<span class="fc" id="L156">            Connection conexao = FabricaConexao.getConexao();</span>
<span class="fc" id="L157">            PreparedStatement ps = conexao.prepareStatement(&quot;select * from pedido where statusPedido = false&quot;);</span>
<span class="fc" id="L158">            ResultSet resultSet = ps.executeQuery();</span>
<span class="fc" id="L159">            List&lt;Pedido&gt; pedidos = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L160" title="All 2 branches covered.">            while (resultSet.next()) {</span>
<span class="fc" id="L161">                Pedido pedido = new Pedido();</span>
<span class="fc" id="L162">                pedido.setId(resultSet.getInt(&quot;id&quot;));</span>
<span class="fc" id="L163">                pedido.setValorTotal(resultSet.getDouble(&quot;valorTotal&quot;));</span>
<span class="fc" id="L164">                pedido.setMesa(resultSet.getInt(&quot;mesa&quot;));</span>
<span class="fc" id="L165">                pedido.setStatusPedido(resultSet.getBoolean(&quot;statusPedido&quot;));</span>
<span class="fc" id="L166">                pedido.setDataCriacao(resultSet.getDate(&quot;dataCriacao&quot;));</span>
<span class="fc" id="L167">                Funcionario funcionario = new Funcionario();</span>
<span class="fc" id="L168">                funcionario.setId(resultSet.getInt(&quot;vendedor&quot;));</span>
<span class="fc" id="L169">                pedido.setVendedor(funcionario);</span>
               
                
                
<span class="fc" id="L173">                pedidos.add(pedido);</span>
<span class="fc" id="L174">            }</span>
<span class="fc" id="L175">            FabricaConexao.fecharConexao();</span>
<span class="fc" id="L176">            return pedidos;</span>

<span class="nc" id="L178">        } catch (SQLException ex) {</span>
<span class="nc" id="L179">            throw new ErroSistema(&quot;Erro ao buscar Pedidos!&quot;, ex);</span>
        }
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>